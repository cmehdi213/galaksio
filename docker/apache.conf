<VirtualHost *:8081>
    ServerName localhost
    ServerAdmin admin@galaksio.local

    # WSGI configuration for Galaksio
    WSGIDaemonProcess galaksio python-home=/opt/venv python-path=/app
    WSGIProcessGroup galaksio
    WSGIScriptAlias / /app/server/server.wsgi

    <Directory /app/server>
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>

    # Static files
    Alias /static /app/client/src
    <Directory /app/client/src>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
    </Directory>

    # Logging
    ErrorLog /app/server/log/error.log
    CustomLog /app/server/log/access.log combined

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self'"

    # Enable compression
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css text/javascript application/javascript application/json
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
    Header append Vary User-Agent

    # Enable caching for static files
    <FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$">
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>
</VirtualHost>
